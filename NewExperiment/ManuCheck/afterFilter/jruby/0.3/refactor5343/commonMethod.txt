(startLine=1863 endLine=1892 srcPath=/home/sonia/NewExperiment/jrubyFilter/01819/core/src/main/java/org/jruby/ir/runtime/IRRuntimeHelpers.java)
    public static DynamicMethod getRefinedMethod(ThreadContext context, RubyClass selfType, String methodName) {
        StaticScope refinedScope = context.getCurrentStaticScope();
        Map<RubyClass, RubyModule> refinements;
        RubyModule refinement;
        DynamicMethod method = null;

        while (true) {
            if (refinedScope == null) break;

            refinements = refinedScope.getOverlayModule(context).getRefinements();

            if (!refinements.isEmpty()) {

                refinement = refinements.get(selfType);

                if (refinement != null) {
                    method = refinement.searchMethod(methodName);

                    if (!method.isUndefined()) {
                        break;
                    }

                    method = null;
                }
            }

            refinedScope = refinedScope.getPreviousCRefScope();
        }
        return method;
    }

